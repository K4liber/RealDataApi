# Define which servers to include in the load balancing scheme.
events {}

http {
    upstream api {
        server api_flask:5000 weight=1;
    }

    # This server accepts all traffic to port 80 and passes it to the upstream.

    server {
         listen 443 ssl;
         server_name api_https;
         ssl_certificate     /etc/nginx/ssl/cert.crt;
         ssl_certificate_key /etc/nginx/ssl/cert.key;
         location / {
              proxy_pass http://api;
              proxy_set_header Host $host;
          }
    }

    server {
        listen 80;
        server_name api_http;
        location / {
            return 301 https://$host$request_uri;
        }
    }
}
